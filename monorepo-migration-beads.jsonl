{"id":"es-001","title":"Create root package.json with npm workspaces","type":"task","status":"open","priority":0,"description":"Create the root package.json that defines npm workspaces for packages/mcp, packages/validate, and packages/shared. Include scripts for: test (run all tests), build (build all), deploy (deploy all), and per-package variants.","acceptance_criteria":"- Root package.json exists with workspaces config\n- npm install works from root\n- Scripts defined for test, build, deploy","created_at":"2025-12-30T12:00:00Z","created_by":"migration"}
{"id":"es-002","title":"Create root tsconfig.json with project references","type":"task","status":"open","priority":0,"description":"Create base tsconfig.json at root with shared compiler options. Use TypeScript project references to link packages. Each package will extend this base config.","acceptance_criteria":"- Root tsconfig.json with strict settings\n- Project references configured\n- Packages can extend base config","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-001"]}
{"id":"es-003","title":"Create packages/shared skeleton","type":"task","status":"open","priority":0,"description":"Create the shared package structure:\n- packages/shared/package.json (name: @expanso/shared)\n- packages/shared/tsconfig.json (extends root)\n- packages/shared/src/index.ts (empty export)\n\nThis will hold schema.json and generated types.","acceptance_criteria":"- Shared package structure exists\n- Package builds successfully\n- Can be imported by other packages","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-002"]}
{"id":"es-004","title":"Create scripts/ directory with deploy skeletons","type":"task","status":"open","priority":0,"description":"Create scripts directory with placeholder deploy scripts:\n- scripts/deploy.sh (deploys both)\n- scripts/deploy-mcp.sh\n- scripts/deploy-validate.sh\n- scripts/generate-schema.sh (placeholder for rpk schema generation)","acceptance_criteria":"- Scripts directory exists\n- Placeholder scripts are executable\n- Comments explain what each will do","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-001"]}
{"id":"es-005","title":"Create CLAUDE.md for monorepo","type":"task","status":"open","priority":0,"description":"Create CLAUDE.md at root with:\n- Monorepo structure explanation\n- Commands for each package\n- How shared code works\n- Deploy instructions","acceptance_criteria":"- CLAUDE.md provides clear guidance\n- Commands are accurate\n- Structure is documented","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-003","es-004"]}
{"id":"es-010","title":"Copy MCP source files to packages/mcp/src","type":"task","status":"open","priority":1,"description":"Copy all .ts files from mcp.expanso.io/src/ to packages/mcp/src/. Include:\n- index.ts, mcp.ts, handlers.ts, chat-ui.ts\n- analytics.ts, examples-registry.ts, docs-links.ts\n- component-schemas.ts, pipeline-validator.ts (will remove later)\n- error-explainer.ts, pattern-suggester.ts, bloblang-reference.ts\n- test-data-generator.ts, compatibility-rules.ts\n- All test files (*.test.ts)\n- types/ directory","acceptance_criteria":"- All source files copied\n- Directory structure preserved\n- No modifications yet (just copy)","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-005"]}
{"id":"es-011","title":"Copy MCP config files to packages/mcp","type":"task","status":"open","priority":1,"description":"Copy configuration files from mcp.expanso.io to packages/mcp/:\n- wrangler.toml\n- tsconfig.json (will need updates)\n- vitest.config.ts (if exists)\n- Any other config files","acceptance_criteria":"- Config files copied\n- wrangler.toml present\n- tsconfig.json present","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-010"]}
{"id":"es-012","title":"Create packages/mcp/package.json","type":"task","status":"open","priority":1,"description":"Create package.json for MCP package:\n- name: @expanso/mcp\n- Copy dependencies from original mcp.expanso.io/package.json\n- Add dependency on @expanso/shared\n- Scripts: dev, deploy, test, typecheck","acceptance_criteria":"- package.json created with correct deps\n- Scripts work\n- Depends on @expanso/shared","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-011"]}
{"id":"es-013","title":"Update MCP wrangler.toml paths","type":"task","status":"open","priority":1,"description":"Update packages/mcp/wrangler.toml:\n- Update main entry point path\n- Verify account_id and routes\n- Update any relative paths","acceptance_criteria":"- wrangler.toml has correct paths\n- wrangler dev works from packages/mcp","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-012"]}
{"id":"es-014","title":"Update MCP tsconfig.json to extend root","type":"task","status":"open","priority":1,"description":"Update packages/mcp/tsconfig.json:\n- Extend from ../../tsconfig.json\n- Add project reference to ../shared\n- Update include/exclude paths","acceptance_criteria":"- tsconfig extends root\n- References shared package\n- tsc --noEmit passes","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-013"]}
{"id":"es-015","title":"Install MCP dependencies and verify build","type":"task","status":"open","priority":1,"description":"From packages/mcp:\n- Run npm install\n- Run npm run typecheck\n- Fix any import path issues","acceptance_criteria":"- npm install succeeds\n- typecheck passes\n- No import errors","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-014"]}
{"id":"es-016","title":"Run MCP tests and fix failures","type":"task","status":"open","priority":1,"description":"From packages/mcp:\n- Run npm test\n- Fix any test failures due to path changes\n- All 668 tests should pass","acceptance_criteria":"- All tests pass\n- No skipped tests (except existing 7 todo)\n- Test output clean","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-015"]}
{"id":"es-017","title":"Verify MCP local dev works","type":"task","status":"open","priority":1,"description":"From packages/mcp:\n- Run npm run dev (wrangler dev)\n- Test chat UI at localhost\n- Test /api/search endpoint\n- Test /mcp endpoint","acceptance_criteria":"- Local dev server starts\n- Chat UI loads and works\n- API endpoints respond correctly","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-016"]}
{"id":"es-020","title":"Copy Validate Rust validator to packages/validate/validator","type":"task","status":"open","priority":1,"description":"Copy from validate.expanso.io/validator/ to packages/validate/validator/:\n- Cargo.toml, Cargo.lock\n- src/ directory (all .rs files)\n- tests/ directory\n- data/ directory\n- Do NOT copy target/ or pkg/ (build artifacts)","acceptance_criteria":"- Rust source copied\n- Cargo.toml present\n- No build artifacts copied","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-005"]}
{"id":"es-021","title":"Copy Validate worker to packages/validate/worker","type":"task","status":"open","priority":1,"description":"Copy from validate.expanso.io/worker/ to packages/validate/worker/:\n- src/ directory (index.ts, schema.json, openapi.json)\n- wrangler.toml\n- tsconfig.json\n- package.json\n- Do NOT copy node_modules/, .wrangler/, pkg/","acceptance_criteria":"- Worker source copied\n- Config files present\n- No build artifacts copied","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-020"]}
{"id":"es-022","title":"Update Validate worker package.json","type":"task","status":"open","priority":1,"description":"Update packages/validate/worker/package.json:\n- name: @expanso/validate\n- Add dependency on @expanso/shared (for later)\n- Verify all dependencies present\n- Scripts: dev, deploy, test, build-wasm","acceptance_criteria":"- package.json updated\n- Dependencies correct\n- Scripts defined","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-021"]}
{"id":"es-023","title":"Update Validate wrangler.toml paths","type":"task","status":"open","priority":1,"description":"Update packages/validate/worker/wrangler.toml:\n- Update main entry point path\n- Verify account_id and routes\n- Update any relative paths","acceptance_criteria":"- wrangler.toml has correct paths\n- Points to correct entry file","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-022"]}
{"id":"es-024","title":"Build Validate WASM from Rust","type":"task","status":"open","priority":1,"description":"From packages/validate/validator:\n- Run wasm-pack build --target web\n- Copy pkg/ output to packages/validate/worker/pkg/\n- Verify WASM loads in worker","acceptance_criteria":"- WASM builds successfully\n- pkg/ contains .wasm and .js files\n- Worker can import WASM","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-023"]}
{"id":"es-025","title":"Install Validate dependencies and verify build","type":"task","status":"open","priority":1,"description":"From packages/validate/worker:\n- Run npm install\n- Run npm run typecheck (if configured)\n- Fix any import path issues","acceptance_criteria":"- npm install succeeds\n- TypeScript compiles\n- No import errors","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-024"]}
{"id":"es-026","title":"Run Validate tests and fix failures","type":"task","status":"open","priority":1,"description":"Run tests for validate:\n- Rust tests: cd validator && cargo test\n- Worker tests: cd worker && npm test (if exists)\n- Fix any failures","acceptance_criteria":"- Rust tests pass\n- Worker tests pass (if any)\n- No regressions","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-025"]}
{"id":"es-027","title":"Verify Validate local dev works","type":"task","status":"open","priority":1,"description":"From packages/validate/worker:\n- Run npm run dev (wrangler dev)\n- Test POST /validate endpoint\n- Test GET /schema endpoint\n- Test GET /health endpoint","acceptance_criteria":"- Local dev server starts\n- Validation endpoint works\n- Schema endpoint returns data","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-026"]}
{"id":"es-030","title":"Move schema.json to packages/shared","type":"task","status":"open","priority":2,"description":"Move the authoritative schema.json:\n- Copy packages/validate/worker/src/schema.json to packages/shared/schema.json\n- Keep copy in validate/worker for now (will update import later)\n- This is the 545KB complete schema from rpk connect list","acceptance_criteria":"- schema.json in packages/shared\n- File is complete (545KB+)\n- Original still in validate (temporary)","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-027","es-017"]}
{"id":"es-031","title":"Create TypeScript types from schema.json","type":"task","status":"open","priority":2,"description":"In packages/shared/src/types/:\n- Create schema-types.ts with TypeScript interfaces for:\n  - ComponentSchema, FieldSchema\n  - Component categories (inputs, outputs, processors, etc.)\n- Export types from packages/shared/src/index.ts","acceptance_criteria":"- TypeScript types match schema structure\n- Types are exported from shared\n- Types compile without errors","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-030"]}
{"id":"es-032","title":"Generate component lists from schema.json","type":"task","status":"open","priority":2,"description":"Create packages/shared/src/component-lists.ts:\n- Read schema.json at build time or import directly\n- Export VALID_INPUTS, VALID_OUTPUTS, VALID_PROCESSORS, etc. as Sets\n- These replace the hand-maintained lists in MCP","acceptance_criteria":"- Component lists generated from schema\n- Exported as typed Sets\n- Lists are complete (all components from schema)","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-031"]}
{"id":"es-033","title":"Copy and update OpenAPI types generation","type":"task","status":"open","priority":2,"description":"Set up OpenAPI type generation in shared:\n- Copy openapi.json from validate to shared (or reference it)\n- Add openapi-typescript as dev dependency\n- Create script to generate validate-api.d.ts\n- Export types from shared","acceptance_criteria":"- OpenAPI types generated\n- Types match current MCP types\n- Generation is scriptable","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-031"]}
{"id":"es-034","title":"Update MCP to import component lists from shared","type":"task","status":"open","priority":2,"description":"In packages/mcp/src/pipeline-validator.ts:\n- Import VALID_INPUTS, VALID_OUTPUTS, etc. from @expanso/shared\n- Remove the local Set definitions\n- Update any references","acceptance_criteria":"- MCP imports from shared\n- Local Sets removed\n- Tests still pass","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-032"]}
{"id":"es-035","title":"Update MCP to import OpenAPI types from shared","type":"task","status":"open","priority":2,"description":"In packages/mcp:\n- Update imports to use @expanso/shared types\n- Remove local types/validate-api.d.ts\n- Update any type references","acceptance_criteria":"- MCP uses shared types\n- Local type file removed\n- TypeScript compiles","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-033"]}
{"id":"es-036","title":"Remove MCP's component-schemas.ts","type":"task","status":"open","priority":2,"description":"Now that MCP uses shared:\n- Delete packages/mcp/src/component-schemas.ts (1146 lines)\n- Update any imports that referenced it\n- Use shared schema for any component lookups\n- Run tests to verify nothing breaks","acceptance_criteria":"- component-schemas.ts deleted\n- No broken imports\n- All tests pass","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-034","es-035"]}
{"id":"es-037","title":"Simplify MCP's pipeline-validator.ts","type":"task","status":"open","priority":2,"description":"Review pipeline-validator.ts after shared integration:\n- Remove any duplicated validation logic that validate API handles\n- Keep only local pre-validation (YAML parse, structure check)\n- Consider if this file can be significantly reduced\n- Run tests after each change","acceptance_criteria":"- Duplicated logic removed\n- File is simpler/smaller\n- Tests still pass","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-036"]}
{"id":"es-038","title":"Update Validate to import schema from shared","type":"task","status":"open","priority":2,"description":"In packages/validate/worker:\n- Update to import schema.json from @expanso/shared\n- Remove local copy of schema.json\n- Verify WASM still works with shared schema","acceptance_criteria":"- Validate uses shared schema\n- Local schema.json removed\n- Validation still works","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-037"]}
{"id":"es-039","title":"Run all tests after shared integration","type":"task","status":"open","priority":2,"description":"From monorepo root:\n- Run npm test (should run all package tests)\n- Verify MCP tests pass (668)\n- Verify Validate tests pass\n- Fix any failures","acceptance_criteria":"- All tests pass\n- No regressions\n- Both packages work with shared","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-038"]}
{"id":"es-040","title":"Integration test: MCP calls Validate locally","type":"task","status":"open","priority":2,"description":"Test the full flow:\n- Start validate dev server on port 8787\n- Start mcp dev server on port 8788\n- Configure MCP to call local validate\n- Test chat generates YAML and validates it\n- Verify validation errors flow correctly","acceptance_criteria":"- Both services run locally\n- MCP successfully calls Validate\n- Full flow works end-to-end","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-039"]}
{"id":"es-050","title":"Create unified deploy script","type":"task","status":"open","priority":3,"description":"Update scripts/deploy.sh:\n- Deploy shared package (if needed)\n- Build validate WASM\n- Deploy validate worker\n- Deploy MCP worker\n- Add flags for deploy-only-changed option","acceptance_criteria":"- Single script deploys all\n- Can deploy individually\n- Handles WASM build","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-040"]}
{"id":"es-051","title":"Create GitHub Actions workflow","type":"task","status":"open","priority":3,"description":"Create .github/workflows/deploy.yml:\n- Trigger on push to main\n- Install deps, build, test\n- Deploy both workers to Cloudflare\n- Use secrets for CLOUDFLARE_API_TOKEN","acceptance_criteria":"- Workflow file created\n- Tests run in CI\n- Deploys on main push","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-050"]}
{"id":"es-052","title":"Create GitHub Actions test workflow","type":"task","status":"open","priority":3,"description":"Create .github/workflows/test.yml:\n- Trigger on pull requests\n- Run all tests\n- Run typecheck\n- Report results","acceptance_criteria":"- PR tests configured\n- All packages tested\n- Clear pass/fail reporting","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-051"]}
{"id":"es-053","title":"Update README.md with monorepo documentation","type":"task","status":"open","priority":3,"description":"Create comprehensive README:\n- Project overview\n- Package descriptions\n- Development setup\n- Commands reference\n- Deployment instructions\n- Contributing guidelines","acceptance_criteria":"- README is complete\n- Commands are accurate\n- Easy to onboard","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-050"]}
{"id":"es-054","title":"Deploy both services from monorepo","type":"task","status":"open","priority":3,"description":"First production deploy from monorepo:\n- Run deploy script\n- Verify mcp.expanso.io works\n- Verify validate.expanso.io works\n- Check for any regressions","acceptance_criteria":"- Both services deployed\n- Production sites work\n- No regressions from original","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-051","es-052","es-053"]}
{"id":"es-055","title":"Archive original mcp.expanso.io repo","type":"task","status":"open","priority":3,"description":"After successful monorepo deploy:\n- Update mcp.expanso.io README to point to monorepo\n- Archive the repo on GitHub\n- Keep for historical reference","acceptance_criteria":"- README updated with redirect\n- Repo archived\n- Clear migration notice","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-054"]}
{"id":"es-056","title":"Archive original validate.expanso.io repo","type":"task","status":"open","priority":3,"description":"After successful monorepo deploy:\n- Update validate.expanso.io README to point to monorepo\n- Archive the repo on GitHub\n- Keep for historical reference","acceptance_criteria":"- README updated with redirect\n- Repo archived\n- Clear migration notice","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-054"]}
{"id":"es-057","title":"Final verification and cleanup","type":"task","status":"open","priority":3,"description":"Final checks:\n- All tests pass in CI\n- Both production sites work\n- No orphaned code\n- Documentation complete\n- Beads cleaned up","acceptance_criteria":"- Everything works\n- Clean codebase\n- Migration complete","created_at":"2025-12-30T12:00:00Z","created_by":"migration","depends_on":["es-055","es-056"]}
